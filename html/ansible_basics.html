				<section>
					<h2>Ansible Basics</h2>
					<h3>Things I found useful</h3>
					<p>
						<small>Created by Lloyd Benson / lloyd.benson@gmail.com</small>
					</p>
					<p>
						<a href="http://github.com/lloydbenson/presentations"><small>http://github.com/lloydbenson/presentations</small></a>
					</p>
				</section>
{{> partials/whoami }}
				<section>
					<h3>overview</h3>
					<ul>
                                           <li>getting started</li>
                                           <li>variables</li>
                                           <li>conditionals</li>
                                           <li>templates</li>
                                           <li>useful plays</li>
                                           <li>dynamic inventory</li>
                                        </ul>
				</section>
				<section>
					<h3>structure</h3>
                                        <pre><code data-trim contenteditable>
ansible.cfg
playbook.yml
hosts
host_vars
group_vars
roles/
   rolename/
     files/
     templates/
     tasks/main.yml
     handlers/main.yml
     vars/main.yml
     defaults/
     meta/main.yml
                                        </code></pre>
				</section>
				<section>
					<h3>the playbook</h3>
                                        <pre><code data-trim contenteditable>
---
- hosts: admin
  vars:
    admins:
      - lloyd
  roles:
    - server
    - pxe
                                        </code></pre>
				</section>
				<section>
					<h3>calling the playbook</h3>
                                        <pre><code data-trim contenteditable>
ansible-playbook -v playbook.yml -i hosts --limit=$1
                                        </code></pre>
				</section>
				<section>
					<h3>variables</h3>
                                        <pre><code data-trim contenteditable>
---
  apps_dir: /apps
  gateway: 192.168.0.1
  tftp_root: /apps/tftpboot
  reserved_addresses:
    - { ip: '192.168.0.100', mac: 'mac1', host: 'host1' }
    - { ip: '192.168.0.101', mac: 'mac2', host: 'host2' }
  dhcp_range: { min: 192.168.0.150, max: 192.168.0.160 }
  domain: domain.com
  platforms: [ 'x86_64', 'i386' ]

                                        </code></pre>
				</section>
				<section>
					<h3>variable precedence (least to most)</h3>
					<ol>
                                           <li>role defaults</li>
                                           <li>inventory vars</li>
                                           <li>inventory group_vars</li>
                                           <li>inventory host_vars</li>
                                           <li>playbook group_vars</li>
                                           <li>playbook host_vars</li>
                                           <li>host facts</li>
                                           <li>registered vars</li>
                                        </ol>
				</section>
				<section>
					<h3>variable precedence (cont)</h3>
					<ol>
                                           <li>set_facts</li>
                                           <li>play vars</li>
                                           <li>play vars_prompt</li>
                                           <li>play vars_files</li>
                                           <li>role and include vars</li>
                                           <li>block vars (only for tasks in block)</li>
                                           <li>task vars (only for the task)</li>
                                           <li>extra vars (always win precedence)</li>
                                        </ol>
				</section>
				<section>
					<h3>get all facts</h3>
                                        <pre><code data-trim contenteditable>
- name: Display all variables/facts known for a host
  debug: var=hostvars[inventory_hostname]
         verbosity=4
                                        </code></pre>
				</section>
				<section>
					<h3>show variable</h3>
                                        <pre><code data-trim contenteditable>
- name: show contents
  debug: var=clonezilla_version
         verbosity=2
                                        </code></pre>
				</section>
				<section>
					<h3>concat variable</h3>
                                        <pre><code data-trim contenteditable>
- users: "\{{ admins }} + \{{ devs }}"
                                        </code></pre>
				</section>
				<section>
					<h3>regular loops</h3>
                                        <pre><code data-trim contenteditable>
- name: generate menus
  template:
    src=menus/\{{ item }}.j2
    dest=\{{ pxelinuxcfg_dir }}/\{{ item }}
  with_items:
    - main_menu
    - default
    - os_menu
    - tool_menu
                                        </code></pre>
				</section>
				<section>
					<h3>nested loops</h3>
                                        <pre><code data-trim contenteditable>
- name: mkdir tftpboot image dirs
  file: path=\{{ bootimg_dir }}/\ 
        \{{ item[0] }}/\
        \{{ item[1].name }}/\
        \{{ item[1].version}}/\
        \{{ item[2] }}
  with_nested:
    - [ 'redhat' ]
    - [ { name: 'centos', version: '7' },
        { name: 'fedora', version: '23'} ]
    - [ 'x86_64', 'i386' ]

                                        </code></pre>
				</section>
				<section>
					<h3>conditionals</h3>
                                        <pre><code data-trim contenteditable>
- name: dnsmasq.conf
  template: src=dnsmasq.conf.j2
            dest=/etc/dnsmasq.conf
  sudo: true
  when: inventory_hostname == 'admin1'
                                        </code></pre>
				</section>
				<section>
					<h3>conditionals</h3>
                                        <pre><code data-trim contenteditable>
slide with rc code
                                        </code></pre>
				</section>
				<section>
					<h3>conditionals</h3>
                                        <pre><code data-trim contenteditable>
slide with changed
                                        </code></pre>
				</section>
				<section>
					<h3>templates</h3>
                                        <pre><code data-trim contenteditable>
domain=\{{ domain }}
dhcp-range=\{{ dhcp_range.min }},\{{ dhcp_range.max }}
{% for address in reserved_addresses %}
dhcp-host=\{{ address.mac  }},\{{ address.ip }}
{% endfor %}
dhcp-option=3,\{{ gateway }}
dhcp-no-override
enable-tftp
tftp-root=\{{ tftp_root }}
dhcp-boot=pxelinux.0,\{{ shorthost }},\{{ ip }}
alias=\{{ gateway }},\{{ ip }}
                                        </code></pre>
				</section>
				<section>
					<h3>partial templates</h3>
                                        <pre><code data-trim contenteditable>
domain=\{{ domain }}
dhcp-range=\{{ dhcp_range.min }},\{{ dhcp_range.max }}
{% include 'roles/rolename/templates/partials/whatever.j2' %}
                                        </code></pre>
				</section>
				<section>
					<h3>lineinfile</h3>
                                        <pre><code data-trim contenteditable>
- name: make sure pub ssh key is in file
  lineinfile: dest=/home/user/.ssh/authorized_keys
              line=\{{ pub_key }}
              state=present
                                        </code></pre>
				</section>
				<section>
					<h3>reboot</h3>
                                        <pre><code data-trim contenteditable>
- name: reboot
  command: /usr/sbin/shutdown -r +1 "logout please"
  ignore_errors: true
  async: 0
  poll: 0
  sudo: true
- name: wait for ssh port to come down
  local_action: wait_for
                port=22
                host=\{{ ansible_host }}
                state=stopped
- name: wait for ssh port to come back up
  local_action: wait_for
                port=22
                host=\{{ ansible_host }}
                state=started
                                        </code></pre>
				</section>
				<section>
					<h3>dynamic inventory</h3>
add slide here
				</section>
				<section>
					<h3>resources</h3>
					<ul>
						<li><a href="http://docs.ansible.com">http://docs.ansible.com</a></li>
						<li><a href="http://docs.ansible.com/ansible/playbooks_variables.html#variable-precedence-where-should-i-put-a-variable">variable precedence</a></li>
					</ul>
				</section>
{{> partials/questions }}
